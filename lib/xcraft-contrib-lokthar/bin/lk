#!/usr/bin/env node
'use strict';

var moduleName = 'lokthar';

var config = require ('xcraft-core-etc').load ('xcraft-contrib-lokthar');
var path = require ('path');
var exec = require ('child_process').exec;

var xLog = require ('xcraft-core-log') (moduleName);
xLog.verbosity (process.env.XCRAFT_LOG ? parseInt (process.env.XCRAFT_LOG) : 2);

var xPlatform = require ('xcraft-core-platform');

var atomDir       = path.join (__dirname, '../build/atom-shell');
var loktharAppDir = path.join (config.appstore, config.appname);

var atom = path.join (atomDir, 'atom' + xPlatform.getExecExt ());

var xServer = require ('xcraft-core-server');
xServer.fork (null, function (line) {
  console.log ('[server:' + process.pid + ']: ' + line);
}, function (line) {
  console.log ('[server:' + process.pid + ']: ' + line);
});

exec (atom + ' ' + loktharAppDir, function (error, stdout, stderr) {
  xLog.verb ('atom outputs:\n' + stdout);

  if (error) {
    xLog.err ('unable to exec atom\n' + stderr);
  }
});
