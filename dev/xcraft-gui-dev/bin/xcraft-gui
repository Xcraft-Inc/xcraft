#!/usr/bin/env node
'use strict';



var xConfig = require ('xcraft-core-etc').load ('xcraft');
var path    = require ('path');
var exec    = require ('child_process').exec;

var xPlatform = require ('xcraft-core-platform');

var usrDir   = path.join (xConfig.pkgTargetRoot, xPlatform.getToolchainArch (), '/usr/');
var binDir   = path.join (usrDir, '/bin/');

var xcraftAtom    = path.join (binDir,    'xcraft-atom');
var appDir        = path.resolve (__dirname, '..');

console.log ('using xcraft-atom from:' + xcraftAtom);
console.log ('launching xcraft-gui from:' + appDir);

var xServer = require ('xcraft-core-server');
xServer.fork (null, function (line) {
  console.log ('[server:' + process.pid + ']: ' + line);
}, function (line) {
  console.log ('[server:' + process.pid + ']: ' + line);
});

exec (xcraftAtom + ' ' + appDir, function (error, stdout, stderr) {
  console.log ('xcraft-atom outputs:\n' + stdout);

  if (error) {
    process.exit (error);
  }
});
