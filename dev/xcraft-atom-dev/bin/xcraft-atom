#!/usr/bin/env node
'use strict';

var moduleName = 'xcraft-atom';

var xConfig = require ('xcraft-core-etc').load ('xcraft');
var path    = require ('path');
var exec    = require ('child_process').exec;

var xLog    = require ('xcraft-core-log') (moduleName);
xLog.verbosity (process.env.XCRAFT_LOG ? parseInt (process.env.XCRAFT_LOG) : 2);

var xPlatform = require ('xcraft-core-platform');

var usrDir   = path.join (xConfig.pkgTargetRoot, xPlatform.getToolchainArch (), '/usr/');
var shareDir = path.join (usrDir, '/share/', '/toolchain/');

var xcraftAtomDir = path.join (shareDir, '/xcraft-atom/', '/atom-shell/');
var atom   = path.join (xcraftAtomDir, 'atom' + xPlatform.getExecExt ());
var appDir = process.argv[2];

xLog.info ('launching xcraft-atom from:' + atom);
xLog.info ('loading this app:' + appDir);

exec (atom + ' ' + appDir, function (error, stdout, stderr) {
  xLog.verb ('atom-shell outputs:\n' + stdout);

  if (error) {
    xLog.err ('atom-shell exited with error\n' + stderr);
  }
});
