'use strict';

var fs   = require ('fs');
var path = require ('path');

exports.cp = function (src, dest)
{
  fs.createReadStream (src).pipe (fs.createWriteStream (dest));
};

exports.mkdir = function (location, root)
{
  var zogPlatform = require ('zogPlatform');

  var dirs = location.split (path.sep);
  var dir  = dirs.shift ();
  var root = (root || '') + dir + path.sep;

  try
  {
    fs.mkdirSync (root);
  }
  catch (err)
  {
    if (!fs.statSync (root).isDirectory ())
      throw new Error (err);
  }

  return !dirs.length || this.mkdir (dirs.join (path.sep), root);
};

exports.cpdir = function (src, dest)
{
  var stats = fs.lstatSync (src);

  if (stats.isFile ())
    exports.cp (src, dest);
  else if (stats.isDirectory ())
  {
    exports.mkdir (dest);
    fs.readdirSync (src).forEach (function (item)
    {
      exports.cpdir (path.join (src, item), path.join (dest, item));
    });
  }
};

exports.lsdir = function (location, regex)
{
  var listIn = fs.readdirSync (location);
  var listOut = [];

  for (var item in listIn)
  {
    if (regex && !regex.test (listIn[item]))
      continue;

    var dir = path.join (location, listIn[item]);
    var st = fs.statSync (dir);
    if (st.isDirectory (dir))
      listOut.push (listIn[item]);
  }

  return listOut;
};

exports.ls = function (location, regex)
{
  var listIn = fs.readdirSync (location);
  var listOut = [];

  for (var item in listIn)
  {
    if (regex && !regex.test (listIn[item]))
      continue;

    listOut.push (listIn[item]);
  }

  return listOut;
};
