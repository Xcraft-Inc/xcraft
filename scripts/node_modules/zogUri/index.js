'use strict';

var moduleName = 'zogUri';

var url       = require ('url');
var zogConfig = require ('../../zogConfig.js') ();

exports.realUri = function (uri, packageName)
{
  var path = require ('path');

  var uriObj = url.parse (uri)

  switch (uriObj.protocol)
  {
  case 'chest:':
    var protocol = 'http:';
    if ((uriObj.slashes ? uriObj.port : zogConfig.chest.port) == 443)
      protocol = 'https:';

    var urlHttp = {};
    urlHttp.protocol = protocol;
    urlHttp.slashes  = true;
    urlHttp.hostname = uriObj.slashes ? uriObj.hostname : zogConfig.chest.host;
    urlHttp.port     = uriObj.slashes ? uriObj.port     : zogConfig.chest.port;
    urlHttp.pathname = url.resolve ('/resources/', uriObj.pathname || uriObj.hostname);
    return url.format (urlHttp);

  case 'package:':
    var urlFile = {};
    urlFile.protocol = 'file:';
    urlFile.slashes  = true;
    urlFile.hostname = uriObj.hostname;
    urlFile.port     = uriObj.port;
    urlFile.pathname = path.join (zogConfig.pkgProductsRoot, packageName, uriObj.pathname).replace (/\\/g, '/');
    return url.format (urlFile);
  }

  return uri;
}
